#!/bin/bash

#**********************************************************************************
# User configurable part
DISK=/dev/sda
KEYMAP="hu"
SWAPSIZE="2G"

USERNAME="arch"     # the password is "arch"
#**********************************************************************************

clear
set -e

#//TODO Echo after steps
echo "----------------------------------------------------------------------------------------------------"
echo " Arch linux setup script"
echo "----------------------------------------------------------------------------------------------------"
CHOISE="no"
read -n1 -r -p "continue? [y/n]" CHOISE
CHOISE=${CHOISE,,} #to lovercase
if [ $CHOISE != "y" ] && [ $CHOISE != "yes" ] && [ $CHOISE != "" ];
then
    echo "Continuing..."
else
    exit 1
fi

#localization, change for your language
loadkeys $KEYMAP
LANG=en_US.UTF-8 >> /etc/locale.conf
KEYMAP=$KEYMAP >> /etc/vconsole.conf

timedatectl set-ntp true
echo "Done setting up locals"

# partitioning
(
    echo n; echo p; echo 1; echo ""; echo +$SWAPSIZE; # creating swap
    echo n; echo p; echo 2; echo ""; echo "";  # creating main filesystem

    echo t; echo 1; echo 19; # (TODO) this needs to be swap, may change
    
    echo w
) | fdisk $DISK
mkswap "${DISK}1"
swapon "${DISK}1"

mkfs.ext4 "${DISK}2"
mount "${DISK}2" /mnt

pacstrap /mnt base linux linux-firmware

genfstab -U /mnt >> /mnt/etc/fstab
echo "Done setting up disk"

arch-chroot /mnt << "EOT"

EOT